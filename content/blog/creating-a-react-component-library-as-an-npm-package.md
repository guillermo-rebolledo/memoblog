---
path: github-npm-pkg
date: 2021-02-04T21:36:45.015Z
title: Creating a React component library as an npm package
description: >-
  My journey through the development of a React component library and how we
  published it to a Github package.
---
## Background

I contribute to a side-project in the company that I work for. I fell in love with the product when two friends in the company pitched it to me. Without going too much into detail (super secret ü§ê) the product encourages people to recognize and empower their teammates. It started with a bot in the Slack workspace, but it has been growing fast as we add new features and ideas. 

We have a SPA (Single Page Application) made with React and Typescript which displays the data gathered by the Slack bot in form of a leaderboard as they communicate via our API in the backend.

As the team grew and new ideas and feature requests started to come in, we realized a component library would be a cool project to embark on. A lot of people joining the team do it to learn React and the technologies that we use, so this library would be a good way to learn and a useful asset as we create new projects from our product.

So here we are, we have a design system and some of the key components already developed. I am familiar with all of these but, now we have to publish our library as a package to npm or in this case, as a Github package.

## Building the package

Some of the key components to build the package are:

* rollup.config.js
* tsconfig.json
* package.json

#### rollup.config.js

Rollup is a module bundler for JavaScript which compiles small pieces of code into something larger and more complex, such as a library or application. It uses the new standardized format for code modules included in the ES6 revision of JavaScript, instead of previous idiosyncratic solutions such as CommonJS and AMD. ES modules let you freely and seamlessly combine the most useful individual functions from your favorite libraries. This will eventually be possible natively everywhere, but Rollup lets you do it today. This file contains the configuration of the build you want to create from your project (transpiling ES6 to ES5, ESM, commonJS, etc).

#### tsconfig.json

The presence of a tsconfig.json file in a directory indicates that the directory is the root of a TypeScript project. The tsconfig.json file specifies the root files and the compiler options required to compile the project.

#### package.json

Aside from all the stuff we know about the purpose of this file, we will specify some extra keys and values that will indicate:

* The version of the package.
* The name and owner (scoped package with Github)
* The main field: The main field is a module ID that is the primary entry point to your program. For most modules, it makes the most sense to have a main script and often not much else.
* New scripts to build and watch the files generated by Rollup.

#### Setting up Rollup

Installing dev dependencies (we use yarn but you can use npm for this too):

```
yarn add -D rollup @rollup/plugin-commonjs @rollup/plugin-node-resolve rollup-plugin-terser rollup-plugin-typescript2
```

rollup.config.js (this exact name is required as well as it being in the root of your project):

```js
// import the plugins for Rollup
import typescript from 'rollup-plugin-typescript2';
import { terser } from 'rollup-plugin-terser';
import commonjs from '@rollup/plugin-commonjs';
import { nodeResolve } from '@rollup/plugin-node-resolve';

import pkg from './package.json';

export default {
  input: 'src/index.tsx',
  output: [
    {
      file: pkg.main,
      format: 'cjs',
      exports: 'named',
      sourcemap: true,
      strict: false
    }
  ],
  plugins: [nodeResolve(), commonjs(), typescript(), terser()],
  external: ['react', 'react-dom', 'fs'],
};
```

* `input` ‚Äì Indicates the root file of the package
* `output` ‚Äì Indicates where to generate the bundled files and the format for them
* `plugins` ‚Äì Indicates which plugins you use and their respective options
* `externals` ‚Äì Indicates which modules being used by the package should be supplied by the host environment

#### Updating the package.json file

* Add `main` key-value: In our case we are using typescript so we use `dist/index.tsx`
* Update the `scripts`: 
  ```
  "build-pkg": "rollup -c",
  "watch-pkg": "rollup -c -w"
  ```
* Add `files` key-value, this indicates npm to only install the files and folders inside the array:
  ```
   "files": ["dist"]
  ```

#### Testing the package

I won't go into detail on this topic, but you can test the package locally using `npm link` or `yarn link`. You can read more [here](https://docs.npmjs.com/cli/v6/commands/npm-link).
