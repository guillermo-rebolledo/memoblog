---
path: github-npm-pkg
date: 2021-02-04T21:36:45.015Z
title: Creating a React component library as an npm package
description: >-
  My journey through the development of a React component library and how we
  published it to a Github package.
---
## Background

I contribute to a side-project in the company that I work for. I fell in love with the product when two friends in the company pitched it to me. Without going too much into detail (super secret ü§ê) the product encourages people to recognize and empower their teammates. It started with a bot in the Slack workspace, but it has been growing fast as we add new features and ideas. 

We have a SPA (Single Page Application) made with React and Typescript which displays the data gathered by the Slack bot in form of a leaderboard as they communicate via our API in the backend.

As the team grew and new ideas and feature requests started to come in, we realized a component library would be a cool project to embark on. A lot of people joining the team do it to learn React and the technologies that we use, so this library would be a good way to learn and a useful asset as we create new projects from our product.

So here we are, we have a design system and some of the key components already developed. I am familiar with all of these but, now we have to publish our library as a package to npm or in this case, as a Github package.

## Building the package

Some of the key components to build the package are:

* rollup.config.js
* tsconfig.json
* package.json

#### rollup.config.js

Rollup is a module bundler for JavaScript which compiles small pieces of code into something larger and more complex, such as a library or application. It uses the new standardized format for code modules included in the ES6 revision of JavaScript, instead of previous idiosyncratic solutions such as CommonJS and AMD. ES modules let you freely and seamlessly combine the most useful individual functions from your favorite libraries. This will eventually be possible natively everywhere, but Rollup lets you do it today. This file contains the configuration of the build you want to create from your project (transpiling ES6 to ES5, ESM, commonJS, etc).

#### tsconfig.json

The presence of a tsconfig.json file in a directory indicates that the directory is the root of a TypeScript project. The tsconfig.json file specifies the root files and the compiler options required to compile the project.

In our case, the tsconfig.json file looks something like this:

```
{
  "compilerOptions": {
    "target": "es5",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noFallthroughCasesInSwitch": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react",
    "declaration": true,
    "declarationDir": "dist"
  },
  "include": [
    "src"
  ],
  "exclude": ["node_modules", "dist", "rollup.config.js", ...otherDirs],
}
```

This file can be different depending on your setup and you or your teams preference when using typescript. One of the main keys here is that we use `"declaration": true` which generates definition files for our packages.

#### package.json

Aside from all the stuff we know about the purpose of this file, we will specify some extra keys and values that will indicate:

* The version of the package.
* The name and owner (scoped package with Github)
* The main field: The main field is a module ID that is the primary entry point to your program. For most modules, it makes the most sense to have a main script and often not much else.
* New scripts to build and watch the files generated by Rollup.

#### Setting up Rollup

Installing dev dependencies (we use yarn but you can use npm for this too):

```
yarn add -D rollup @rollup/plugin-commonjs @rollup/plugin-node-resolve rollup-plugin-terser rollup-plugin-typescript2
```

rollup.config.js (this exact name is required as well as it being in the root of your project):

```js
// import the plugins for Rollup
import typescript from 'rollup-plugin-typescript2';
import { terser } from 'rollup-plugin-terser';
import commonjs from '@rollup/plugin-commonjs';
import { nodeResolve } from '@rollup/plugin-node-resolve';

import pkg from './package.json';

export default {
  input: 'src/index.tsx',
  output: [
    {
      file: pkg.main,
      format: 'cjs',
      exports: 'named',
      sourcemap: true,
      strict: false
    }
  ],
  plugins: [nodeResolve(), commonjs(), typescript(), terser()],
  external: ['react', 'react-dom', 'fs'],
};
```

* `input` ‚Äì Indicates the root file of the package
* `output` ‚Äì Indicates where to generate the bundled files and the format for them
* `plugins` ‚Äì Indicates which plugins you use and their respective options
* `externals` ‚Äì Indicates which modules being used by the package should be supplied by the host environment

#### Updating the package.json file

* Add `main` key-value: In our case we are using typescript so we use:
  ```
   "dist/index.js"
  ```
* Update the `scripts`: 
  ```
  "build-pkg": "rollup -c",
  "watch-pkg": "rollup -c -w"
  ```
* Add `files` key-value, this indicates npm to only install the files and folders inside the array:
  ```
   "files": ["dist"]
  ```

Our package.json is looking like this:

```
{
  "name": "@<OWNER>/<NAME_OF_PACKAGE>",
  "version": "0.1.55",
  "description": "Component library made with React",
  "repository": {
    "url": "git://github.com/<OWNER>/<NAME_OF_PACKAGE>.git"
  },
  "main": "dist/index.js",
  "files": [
    "dist"
  ],
  "keywords": [
    "react",
    "typescript",
    "npm",
    "storybook"
  ],
  "scripts": {
    ...
    "build-pkg": "rollup -c",
    "start-pkg": "rollup -c -w"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "devDependencies": {    ...
    "@rollup/plugin-commonjs": "^17.1.0",
    "@rollup/plugin-node-resolve": "^11.1.1",
    "rollup": "^2.38.4",
    "rollup-plugin-terser": "^7.0.2",
    "rollup-plugin-typescript2": "^0.29.0",
  }
}
```

#### Testing the package

I won't go into detail on this topic, but you can test the package locally using `npm link` or `yarn link`. You can read more [here](https://docs.npmjs.com/cli/v6/commands/npm-link).

#### Publishing the package

You can find more information about publishing your npm package to the Github registry [here](https://docs.github.com/en/packages/guides/configuring-npm-for-use-with-github-packages). I'm gonna give a brief overview of the steps below:

First, since the repo where our package lives is inside our company's Github organization, there is a couple of extra steps that we needed to make. 

* [Create a personal access token in Github](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token). Make sure you give it the `read:packages` and `write:packages` permissions only.
* This step will let us authenticate to Github Packages with npm. Once we have the token copied to the clipboard, edit the global npm configuration file. You can open it with your favorite text editor, in my case, I picked vscode:  


```
code ~/.npmrc
```

* Copy the next line and replace _**TOKEN**_ with the personal access token that you just generated the both `//` included.


```
//npm.pkg.github.com/:_authToken=TOKEN
```

* Normally, you would have to bump the version in your `package.json` file every release. After that, if everything is good up to this point, you should be able to run `npm publish` and see the magic happen. ‚ú®
* In the project where you plan to install and use you package, you will have to create a local `.npmrc` if you haven't already and add the registry for the scoped package we are publishing (All Github Packages are scoped by default). Remember to replace OWNER with the organization or your github username depending on where your repo is located. This next line indicates npm/yarn where to find your package (since it is not in the public npm registry).:


```
@OWNER:registry=https://npm.pkg.github.com
```

* After specifying the registry in your npm config file, you can go ahead and do an install.


```
yarn add @<OWNER>/<NAME_OF_PACKAGE>
```

* If everything is right, you should see your package added to the dependencies in your project.

## Conclusion

So now we have our very own npm package published in Github Packages. Now we can use our component library across all of our projects with a consistent look and feel. It was a tricky task to complete but at the end, it is nice to see a working and installable npm package made by our team. Especially being my first time doing publishing one.

The next steps for me would be to automate the releases of the package via Github Actions for example.

Useful links:

* [Publishing a React Package to npm - LogRocket](https://blog.logrocket.com/the-complete-guide-to-publishing-a-react-package-to-npm/)
* [Configuring bpm for use with Github Packages](https://docs.github.com/en/packages/guides/configuring-npm-for-use-with-github-packages)
* [About Github Packages](https://docs.github.com/en/packages/learn-github-packages/about-github-packages)
* [Creating a Personal Access Token](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token)
